# 数据库迁移说明

## 新增 AI 使用统计功能

已添加 `AIUsage` 表用于记录通义千问 AI 的使用统计。

### 执行迁移

在 `backend` 目录下运行：

```bash
# 生成 Prisma Client
npx prisma generate

# 创建并应用迁移
npx prisma migrate dev --name add_ai_usage_stats
```

### 新增表结构

```prisma
model AIUsage {
  id          Int      @id @default(autoincrement())
  model       String   @db.VarChar(50) // 模型名称，如 qwen-turbo, qwen-plus, wanx-v1
  type        String   @db.VarChar(20) // text-rewrite, image-generate
  inputTokens Int      @default(0)
  outputTokens Int     @default(0)
  createdAt   DateTime @default(now())
  userId      Int?

  @@index([model])
  @@index([type])
  @@index([createdAt])
}
```

### 功能说明

- **自动记录**：每次调用 AI 功能时自动记录使用情况
- **统计维度**：
  - 按模型统计（qwen-turbo, qwen-plus, wanx-v1 等）
  - 按功能类型统计（文案改写、AI生图）
  - 总体统计
- **Token 统计**：记录输入和输出的 token 数量

### API 接口

- `GET /api/ai/stats` - 获取 AI 使用统计

### 前端展示

首页会显示：
- 总调用次数
- 输入 Token 总数
- 输出 Token 总数
- 总 Token 数
- 按模型分组的详细统计
- 按功能类型分组的详细统计

